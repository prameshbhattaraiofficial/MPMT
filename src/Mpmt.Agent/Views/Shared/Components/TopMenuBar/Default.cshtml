
<link href="~/css/greenblick.css" rel="stylesheet" />
<div class="topbar">
    <!-- Navbar -->
    <nav class="navbar-custom">
        <ul class="list-unstyled topbar-nav float-end mb-0">
            @*<li class="dropdown hide-phone">
                <a class="nav-link dropdown-toggle arrow-none waves-light waves-effect" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <i data-feather="search" class="topbar-icon"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-lg p-0">
                    <!-- Top Search Bar -->
                     <div class="app-search-topbar">
                        <form action="#" method="get">
                            <input type="search" name="search" class="from-control top-search mb-0" placeholder="Type text...">
                            <button type="submit"><i class="ti-search"></i></button>
                        </form>
                    </div> 
                </div>
                </li>*@
            <li class="dropdown notification-list" onclick="ShowNotification(event)">
                <a class="nav-link dropdown-toggle arrow-none waves-light waves-effect text-primary" data-bs-toggle="dropdown" href="#" role="button"
                aria-haspopup="false" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg"  width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell align-self-center topbar-icon">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                   
                        @*<span id="AdminNotificationCount" class="badge bg-soft-danger rounded-pill noti-icon-badge">@count</span>*@
                    
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-lg pt-0">
                    <h6 class="dropdown-item-text font-15 m-0 py-3 border-bottom d-flex justify-content-between align-items-center">
                        Notifications @*<span class="badge bg-soft-primary rounded-pill"></span>*@
                    </h6>
                    <div class="notification-menu data-simplebar" id="notificationList">
                        <!-- item-->
                        @{

                            //foreach (var item in await _notify.GetAdminNotificationAsync())
                            //{
                            //    <a href="#" class="dropdown-item py-3">
                            //        <small class="float-end text-muted ps-2">@{
                            //                //DateTime convertedDate = DateTime.SpecifyKind(
                            //                //item.Created,
                            //                //DateTimeKind.Utc);
                            //                //var data = convertedDate.ToLocalTime()
                            //            ;
                            //            }@item.CreatedDate.Humanize();

                            //             </small>
                            //        <div class="media">
                            //            <div class="avatar-md bg-soft-primary">
                            //                <i data-feather="shopping-cart" class="align-self-center icon-xs"></i>
                            //            </div>
                            //            <div class="media-body align-self-center ms-2 text-truncate">
                            //                <h6 class="my-0 fw-normal text-dark">Your order is placed</h6>
                            //                <small class="text-muted mb-0">
                            //                    @item.Message
                            //                </small>
                            //            </div>
                            //            <!--end media-body-->
                            //        </div>
                            //        <!--end media-->
                            //    </a>
                            //}
                        }

                        <!--end-item-->
                       
                    </div>
                    <!-- All-->
                  
                    <a  asp-controller="Home" asp-action="notifications" class="dropdown-item text-center text-primary">
                        View all <i class="fi-arrow-right"></i>
                    </a>
                </div>
            </li>
            <li class="dropdown">
                <a class="nav-link dropdown-toggle waves-effect waves-light nav-user" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">

                    <img src="~/assets/images/player.png" alt="profile-user" class="rounded-circle thumb-xs" /><span class="fas fa-angle-down mx-1"></span>
                </a>
        
                <div class="dropdown-menu dropdown-menu-end">
                    <a class="dropdown-item" asp-controller="Agent" asp-action="Profile"><i data-feather="user" class="align-self-center icon-xs icon-dual me-1"></i> Profile</a>
                    <a class="dropdown-item" onclick="ShowPopUp('@Url.Action("ChangePassword","Agent")','Change Password','modal-dialog modal-md')">
                        <i data-feather="lock" class="align-self-center icon-xs icon-dual me-1"></i> Change Password
                    </a>

                    <div class="dropdown-divider mb-0"></div>
                    <a class="dropdown-item" onclick="logoutsignalR()"  asp-controller="Login" asp-action="Logout"><i data-feather="power" class="align-self-center icon-xs icon-dual me-1"></i> Logout</a>
                </div>
            </li>
        </ul>
        <!--end topbar-nav-->
        <ul class="list-unstyled topbar-nav mb-0">
            <li>
                <button class="nav-link button-menu-mobile">
                    <i data-feather="menu" class="align-self-center topbar-icon"></i>
                </button>
            </li>

            <li class=""><h6 style="margin-top:25px;"><b>@ViewBag.AgentName </b> <div class="green-blink"></div></h6></li>

        </ul>
    </nav>
    <!-- end navbar-->
</div>
  
<script>

    function ShowNotification(event){
        let texta = "";
       
        var decodeurl = decodeURIComponent('/admin/admindashboard/Getnotification');
        $.ajax({
            type: "GET",
            url: decodeurl,
            success: function (res) {
                console.log(res);
                for (let i = 0; i < res.length; i++) {
                    let humanizedDate = humanizeUTCDate(res[i].createdDate);
                    
                    texta += `
                             <a href="${res[i].adminLink}" class="dropdown-item py-3">
                            <small class="float-end text-muted ps-2">${humanizedDate}</small>
                        <div class="media">
                            <div class="avatar-md bg-soft-primary">
                                <i data-feather="shopping-cart" class="align-self-center icon-xs"></i>
                            </div>
                            <div class="media-body align-self-center ms-2 text-truncate">
                                <h6 class="my-0 fw-normal text-dark">${res[i].message}</h6>
                                <small class="text-muted mb-0"></small>
                            </div>
                            <!--end media-body-->
                        </div>
                        <!--end media-->
                    </a>`;
                }
                $("#notificationList").html("");
                $("#notificationList").append(texta);
            }

        });
        event.stopPropagation();
        
    }
    function humanizeUTCDate(utcDateString) {
        const utcDate = moment.utc(utcDateString); // Convert to Moment.js UTC object
        const localDate = utcDate.local(); // Convert to local time

        const now = moment(); // Current time in local time zone
        const diffInSeconds = now.diff(localDate, 'seconds'); // Get difference in seconds

        const seconds = Math.floor(diffInSeconds);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        const months = Math.floor(days / 30); // Approximation, not precise
        const years = Math.floor(months / 12); // Approximation, not precise

        if (seconds < 60) {
            return seconds + (seconds === 1 ? ' second ago' : ' seconds ago');
        } else if (minutes < 60) {
            return minutes + (minutes === 1 ? ' minute ago' : ' minutes ago');
        } else if (hours < 24) {
            return hours + (hours === 1 ? ' hour ago' : ' hours ago');
        } else if (days < 30) {
            return days + (days === 1 ? ' day ago' : ' days ago');
        } else if (months < 12) {
            return months + (months === 1 ? ' month ago' : ' months ago');
        } else {
            return years + (years === 1 ? ' year ago' : ' years ago');
        }
    }
</script>
<link href="~/pnotify/css/pnotify.custom.min.css" rel="stylesheet" />
<script src="~/pnotify/js/pnotify.custom.min.js"></script>
<script src="~/pnotify/js/notify-event.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script src="~/js/admin.pagination.js" asp-append-version="true"></script>
<script src="~/js/admin.users.js" asp-append-version="true"></script>
<script src="~/js/site.js"></script>
<script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>
<script src="~/js/hubs/notificationcount.js"></script>