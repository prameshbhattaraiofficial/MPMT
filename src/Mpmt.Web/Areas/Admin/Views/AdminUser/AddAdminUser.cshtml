@using Mpmt.Core.ViewModel.AdminUser
@model AdminUserVm

<ul>
    @if (ViewBag.Error is not null)
    {
        <li class="text-danger">@ViewBag.Error</li>
    }
</ul>

<form id="AdminUserForm" class="form-horizontal auth-form" method="post" autocomplete="off">
    <div class="row">
        <div class="col-md-3 mb-2">
            <label asp-for="UserName" class="form-label">Username *</label>
            <input asp-for="UserName" type="text" class="form-control">
            <span asp-validation-for="UserName" class="text-danger"></span>
        </div>
        <div class="col-md-4 mb-2">
            <label asp-for="FullName" class="form-label">Full Name</label>
            <input asp-for="FullName" type="text" class="form-control">
            <span asp-validation-for="FullName" class="text-danger"></span>
        </div>
        <div class="col-md-2 mb-2">
            <label asp-for="Gender" class="form-label">Gender</label>
            <select asp-for="Gender" class="form-select" asp-items="@ViewBag.Gender">
            </select>
            <span asp-validation-for="Gender" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="RoleId" class="form-label">Role</label>
            <select asp-for="RoleId" class="form-select" asp-items="@ViewBag.Role">
            </select>
            <span asp-validation-for="RoleId" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="MobileNumber" class="form-label">Phone Number</label>
            @* <input asp-for="MobileNumber" onkeydown="return isNumber(event)" type="text" maxlength="15" class="form-control"> *@
            <input type="text" class="form-control" maxlength="10" asp-for="MobileNumber" onkeypress="return isNumber(event)" placeholder="" required>
            <span asp-validation-for="MobileNumber" class="text-danger"></span>
        </div>
        <div class="col-md-4 mb-2">
            <label asp-for="Address" class="form-label">Address</label>
            <input asp-for="Address" type="text" class="form-control">
            <span asp-validation-for="Address" class="text-danger"></span>
        </div>
        <div class="col-md-5 mb-2">
            <label asp-for="Email" class="form-label">Email *</label>
            <input asp-for="Email" type="email" class="form-control">
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="Department" class="form-label">Department</label>
            <input asp-for="Department" type="text" class="form-control" />
            <span asp-validation-for="Department" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="DateOfBirth" class="form-label">Birth date</label>
            <input asp-for="DateOfBirth" id="DateOfBirth" type="date" max="@DateTime.Now.AddYears(-18).ToString("yyyy-MM-dd")" min="@DateTime.Now.AddYears(-130).ToString("yyyy-MM-dd")" class="form-control">
            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
        </div>
        <div class="col-md-6 mb-2">
            <label asp-for="ProfileImage" class="form-label">Profile Image</label>
            <div class="input-group mb-3">
                <input asp-for="ProfileImage" type="file" class="form-control" accept=".png, .jpg, .jpeg" onchange="onimagechange(this,'ProfileImageUrlId','ProfileImagetextid')">
            </div>
            <span id="ProfileImagetextid" class="text-danger" hidden></span>
            <img id="ProfileImageUrlId" src="#" style="width:90px;" hidden>
            <span asp-validation-for="ProfileImage" class="text-danger"></span>
        </div>
        <div class="col-md-6  mb-2">
            <label asp-for="Password" class="form-label">Password</label>
            <div class="input-group">
                <input asp-for="Password" type="password" class="form-control" id="id_password"> &ensp;
                <i id="togglePassword"  class="mdi mdi-eye align-self-center font-16 icon-dual me-1"></i>
            </div>
            <span asp-validation-for="Password" class="text-danger"></span>
        </div>
        <div class="col-md-6  mb-2">
            <label asp-for="ConfirmPassword" class="form-label">Confirm Password</label>
            <div class="input-group">
                <input asp-for="ConfirmPassword" type="password" class="form-control" id="id_confirm_password"> &ensp;
                <i id="togglePasswordConfirm"  class="mdi mdi-eye align-self-center font-16 icon-dual me-1"></i>
            </div>
            <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
        </div>
        <div class="form-check form-switch mb-2">
            <input asp-for="IsActive" class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
            <label class="form-check-label" for="flexSwitchCheckDefault">Is Active</label>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-sm btn-primary">Submit<i class="fas fa-paper-plane ms-1"></i></button>
    </div>
</form>

<script>
    // const togglePass = document.querySelector('#togglePassword');
    // const togglePassConfirm = document.querySelector('#togglePasswordConfirm');
    // const pass = document.querySelector('#id_password');
    // const passConfirm = document.querySelector('#id_confirm_password');

    // togglePass.addEventListener('click', function (e) {
    //     const type = pass.getAttribute('type') === 'password' ? 'text' : 'password';
    //     pass.setAttribute('type', type);

    //     togglePass.classList.toggle('mdi-eye');
    //     togglePass.classList.toggle('mdi-eye-off');
    // });
    // togglePassConfirm.addEventListener('click', function (e) {
    //     const type = passConfirm.getAttribute('type') === 'password' ? 'text' : 'password';
    //     passConfirm.setAttribute('type', type);

    //     togglePassConfirm.classList.toggle('mdi-eye');
    //     togglePassConfirm.classList.toggle('mdi-eye-off');
    // });

    $(document).ready(function () {
        
        setupToggleButtons();
    });

    function setupToggleButtons() {
        
        const togglePass = document.querySelector('#togglePassword');
        const togglePassConfirm = document.querySelector('#togglePasswordConfirm');
        const pass = document.querySelector('#id_password');
        const passConfirm = document.querySelector('#id_confirm_password');

        togglePass.addEventListener('click', function (e) {
            const type = pass.getAttribute('type') === 'password' ? 'text' : 'password';
            pass.setAttribute('type', type);
            togglePass.classList.toggle('mdi-eye');
            togglePass.classList.toggle('mdi-eye-off');
        });

        togglePassConfirm.addEventListener('click', function (e) {
            const type = passConfirm.getAttribute('type') === 'password' ? 'text' : 'password';
            passConfirm.setAttribute('type', type);
            togglePassConfirm.classList.toggle('mdi-eye');
            togglePassConfirm.classList.toggle('mdi-eye-off');
        });
    }
</script>

<script>
    function onimagechange(data, id, textid) {

        readURL(data, id, textid);


    }
    function readURL(input, id, textid) {

        if (input.files && input.files[0]) {
            if (input.files[0].type.split('/')[0] != 'image') {
                $('#' + id).attr('src', "");
                document.getElementById(textid).innerHTML = 'Invalid file extension'
                $('#' + textid).removeAttr('hidden');
                return false
            }
            else if (input.files[0].size < (5 * 1024 * 1024)) {
                var reader = new FileReader();
                reader.onload = function (e) {

                    var data = e.target.result;
                    document.getElementById(textid).innerHTML = ''
                    $('#' + id).attr('src', e.target.result);
                    $('#' + id).removeAttr('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
            else {
                $('#' + id).attr('src', "");
                document.getElementById(textid).innerHTML = 'Invalid Image File Size (<5 MB)'
                $('#' + textid).removeAttr('hidden');
            }
        }
    };

</script>

<script>
    // const togglePass = document.querySelector('#togglePassword');
    // const togglePassConfirm = document.querySelector('#togglePasswordConfirm');
    // const pass = document.querySelector('#id_password');
    // const passConfirm = document.querySelector('#id_confirm_password');
    // togglePass.addEventListener('click', function (e) {
    //     const type = pass.getAttribute('type') === 'password' ? 'text' : 'password';
    //     pass.setAttribute('type', type);
    // });
    // togglePassConfirm.addEventListener('click', function (e) {
    //     const type = passConfirm.getAttribute('type') === 'password' ? 'text' : 'password';
    //     passConfirm.setAttribute('type', type);
    // });
</script>

<script>
    FormHandler.init({
        method: 'POST',
        actionUrl: '@Url.Action("AddAdminUser", "AdminUser")',
        containerSelector: '#add-new .modal-body',
        selector: '#AdminUserForm'
    }, function () {
        $("#add-new .modal-body").html("");
        $("#add-new .modal-title").html("");
        $("#add-new").modal('hide');
        Pagination.getData();
    });
</script>