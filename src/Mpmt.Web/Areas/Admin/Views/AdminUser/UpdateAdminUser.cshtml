@using Mpmt.Core.Dtos.Users;
@model IUDAdminUser

<ul>
    @if (ViewBag.Error is not null)
    {
        <li class="text-danger">@ViewBag.Error</li>
    }
</ul>

<form id="AdminUserFormUpdate" class="form-horizontal auth-form" method="post" autocomplete="off">
    <div class="row">
        <input asp-for="Id" hidden/>
        <input asp-for="ProfileImageUrlPath" hidden/>
        <div class="col-md-3 mb-2">
            <label asp-for="UserName" class="form-label">Username</label>
            <input asp-for="UserName" type="text" class="form-control">
            <span asp-validation-for="UserName" class="text-danger"></span>
        </div>
        <div class="col-md-4 mb-2">
            <label asp-for="FullName" class="form-label">Full Name</label>
            <input asp-for="FullName" type="text" class="form-control">
            <span asp-validation-for="FullName" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="Gender" class="form-label">Gender</label>
            <select asp-for="Gender" class="form-select" asp-items="@ViewBag.Gender">
            </select>
            <span asp-validation-for="Gender" class="text-danger"></span>
        </div>
       @*  <div class="col-md-2 mb-2">
            <label asp-for="RoleId" class="form-label">Role</label>
            <select asp-for="RoleId" class="form-select" asp-items="@ViewBag.Role">
            </select>
            <span asp-validation-for="RoleId" class="text-danger"></span>
        </div> *@
        <div class="col-md-3 mb-2">
            <label asp-for="MobileNumber" class="form-label">Phone Number</label>
            @* <input asp-for="MobileNumber" onkeydown="return isNumber(event)" type="text" maxlength="15" class="form-control"> *@
            <input type="text" class="form-control" maxlength="10" asp-for="MobileNumber" onkeypress="return isNumber(event)" placeholder="" required>
            <span asp-validation-for="MobileNumber" class="text-danger"></span>
        </div>
        <div class="col-md-4 mb-2">
            <label asp-for="Address" class="form-label">Address</label>
            <input asp-for="Address" type="text" class="form-control">
            <span asp-validation-for="Address" class="text-danger"></span>
        </div>
        <div class="col-md-5 mb-2">
            <label asp-for="Email" class="form-label">Email</label>
            <div class="input-group has-validation">
               @*  @{
                    var sa = "@";
                }
                <span class="input-group-text" id="inputGroupPrepend">@sa</span> *@
                <input asp-for="Email" type="email" class="form-control">
            </div>
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="Department" class="form-label">Department</label>
            <input asp-for="Department" type="text" class="form-control" />
            <span asp-validation-for="Department" class="text-danger"></span>
        </div>
        <div class="col-md-3 mb-2">
            <label asp-for="DateOfBirth" class="form-label">Birth date</label>
            <input asp-for="DateOfBirth" id="DateOfBirth" type="date" class="form-control">
            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
        </div>
        <div class="col-md-6 mb-2">
            <label asp-for="ProfileImage" class="form-label">ID Front *</label>
            <div class="input-group mb-3">
                <input asp-for="ProfileImage" type="file" class="form-control" accept=".png, .jpg, .jpeg" onchange="onimagechange(this,'IDFrontId','fronthide','ProfileImagetextid')">
            </div>
            <span asp-validation-for="ProfileImage" class="text-danger"></span>
            <span id="ProfileImagetextid" class="text-danger" hidden></span>
            @{
                if (Model != null)
                {
                    if (!string.IsNullOrWhiteSpace(Model.ProfileImageUrlPath))
                    {
                        <img style="width:90px;" id="fronthide" src="@Model.ProfileImageUrlPath" alt="@Model.ProfileImageUrlPath">
                    }
                }
            }
            <img id="IDFrontId" src="#" style="width:90px;" hidden>
        </div>
        <div class="form-check form-switch mb-2">
            <input asp-for="IsActive" class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
            <label class="form-check-label" for="flexSwitchCheckDefault">Is Active</label>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-sm btn-primary">Submit<i class="fas fa-paper-plane ms-1"></i></button>
    </div>
</form>

<script>
    function onimagechange(data, id, hideid, textid) {
        readURL(data, id, textid);
        $('#' + hideid).attr("hidden", true);

    }
    function readURL(input, id, textid) {

        if (input.files && input.files[0]) {
            if (input.files[0].type.split('/')[0] != 'image') {
                $('#' + id).attr('src', "");
                document.getElementById(textid).innerHTML = 'Invalid file extension'
                $('#' + textid).removeAttr('hidden');
                return false
            }
            else if (input.files[0].size < (5 * 1024 * 1024)) {
                var reader = new FileReader();
                reader.onload = function (e) {

                    var data = e.target.result;
                    document.getElementById(textid).innerHTML = ''
                    $('#' + id).attr('src', e.target.result);
                    $('#' + id).removeAttr('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
            else {
                $('#' + id).attr('src', "");
                document.getElementById(textid).innerHTML = 'Invalid Image File Size (<5 MB)'
                $('#' + textid).removeAttr('hidden');
            }
        }
    };
</script>

<script>
    const togglePass = document.querySelector('#togglePassword');
    const togglePassConfirm = document.querySelector('#togglePasswordConfirm');
    const pass = document.querySelector('#id_password');
    const passConfirm = document.querySelector('#id_confirm_password');
    togglePass.addEventListener('click', function (e) {
        const type = pass.getAttribute('type') === 'password' ? 'text' : 'password';
        pass.setAttribute('type', type);
    });
    togglePassConfirm.addEventListener('click', function (e) {
        const type = passConfirm.getAttribute('type') === 'password' ? 'text' : 'password';
        passConfirm.setAttribute('type', type);
    });
</script>

<script>
    FormHandler.init({
        method: 'POST',
        actionUrl: '@Url.Action("UpdateAdminUser", "AdminUser")',
        containerSelector: '#add-new .modal-body',
        selector: '#AdminUserFormUpdate'
    }, function () {
        $("#add-new .modal-body").html("");
        $("#add-new .modal-title").html("");
        $("#add-new").modal('hide');
        Pagination.getData();
    });
</script>