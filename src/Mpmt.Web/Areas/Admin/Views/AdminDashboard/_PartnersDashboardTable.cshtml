@using Mpmt.Core.Dtos.AdminDashboard
@model AdminDashboardDetails

@if (Model.dashboardTopPartner != null && Model.dashboardTopPartner.Count > 0)
{
    <div class="table-responsive">
        <div style="max-height: 250px; overflow-y: auto;">
            <table id="tableTopPartnerId" class="table table-sm table-striped dataTable nowrap" data-sort-action="/admin/AdminDashboard/SortTopPartnerList" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                <thead class="table-light">
                    <tr>
                        <th>
                            <span>Name</span>
                        </th>
                        <th class="sortable" style="cursor: pointer" data-sort="TXN">
                            <span>No. of Txn</span>
                            <i class="fa fa-sort"></i>
                        </th>
                        <th class="sortable" style="cursor: pointer" data-sort="VOLUME">
                            <span>Volume</span>
                            <i class="fa fa-sort"></i>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.dashboardTopPartner)
                    {
                        <tr>
                            <td>@item.PartnerName</td>
                            <td>@item.TotalTrans</td>
                            <td>@item.VolumeText</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <h5 class="text-danger text-center">No Partners data</h5>
}

<script>
    $(document).ready(function () {
        // Cache table element
        var table = $('#tableTopPartnerId');
        var currentSort = null; // Stores current sort information (column and order)

        // Function to handle table sorting
        function sortTable(th) {
            var sortColumnName = $(th).data('sort');
            var sortOrder = 'asc';

            // Toggle sort order on each click
            if (currentSort && currentSort.columnName === sortColumnName) {
                sortOrder = currentSort.sortOrder === 'asc' ? 'desc' : 'asc';
            }

            // Update current sort information
            currentSort = { columnName: sortColumnName, sortOrder: sortOrder };

            var selectedPeriod = document.getElementById("topPartnerList").value;

            var table = $(th).closest('table');
            var url = table.data('sortAction');

            // Send sort data to controller using AJAX or form submission
            $.ajax({
                url: url, // Replace with your controller URL
                type: 'POST',
                data: {
                    columnName: sortColumnName,
                    sortOrder: sortOrder,
                    selectedPeriod: selectedPeriod
                },
                success: function (response) {
                    debugger;
                    if (response.hasOwnProperty('partnerData')) {
                        // Update table header icons
                        $(th).closest('table').find('.sortable i').removeClass('fa-sort-up fa-sort-down').removeClass('text-danger').addClass('fa-sort'); // Reset all icons
                        $(th).find('i').addClass(sortOrder === 'asc' ? 'fa-sort-up text-danger' : 'fa-sort-down text-danger'); // Update clicked header icon

                        // Clear existing table rows
                        $('#tableTopPartnerId tbody').empty();

                        // Iterate over received data and update table body
                        $.each(response.partnerData, function (index, item) {
                            var newRow = $('<tr>');
                            newRow.append('<td>' + item.partnerName + '</td>');
                            newRow.append('<td>' + item.totalTrans + '</td>');
                            newRow.append('<td>' + item.volumeText + '</td>');
                            $('#tableTopPartnerId tbody').append(newRow);
                        });
                    }
                }
            });
        }

        // Attach click event listener to headers
        $('.sortable').on('click', function () {
            sortTable(this);
        });
    });
</script>